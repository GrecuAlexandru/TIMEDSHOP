<html lang="en">
  <head>
    <link rel="icon" href="resources/icons/favicon.png" />
    <link rel="stylesheet" href="styles/women.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <title>Timed - Women</title>
    <script type="module" src="resources/women/women.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  </head>
  <body>
    <div id="TimedShopMainLogo">
      <img src="resources/icons/TimedShopMainLogo.svg" alt="TIMED SHOP" />
    </div>
    <nav class="navMenu" id="navMenu">
      <a href="Sale.html">SALE</a>
      <a href="Women.html" id="women">WOMEN</a>
      <a href="Men.html">MEN</a>
      <a href="Accessories.html">ACCESSORIES</a>
      <a href="LogIn.html" id="LogIn">LOG IN</a>
      <a href="Register.html">REGISTER</a>
      <a href="Cart.html" id="cart" class="icon-badge-container">
        <img
          class="icon-badge-icon"
          alt="CART"
          src="/resources/icons/Cart.svg"
          onmouseover="this.src='resources/icons/CartPurple.svg'"
          onmouseout="this.src='resources/icons/Cart.svg'"
        />
        <div class="icon-badge">6</div>
      </a>
      <div class="dot" id="dott"></div>
    </nav>
    <div id="sectionSpecifier">WOMEN</div>

    <div id="fullProductsDiv">
      <div id="sorter">
        <a id="sortBy">SORT BY:</a>
        <div class="dropdown">
          <button onclick="dropdownFunction()" class="dropbtn">
            <a id="dropdownTitle">New Arrival</a
            ><img
              id="dropdownArrowImg"
              src="resources/icons/dropdownArrow.svg"
            />
          </button>
          <div id="myDropdown" class="dropdown-content">
            <a id="newArrival" onclick="newArrivalClicked()">New Arrival</a>
            <a id="PriceLH" onclick="PriceLHClicked()">Price (Low to High)</a>
            <a id="PriceHL" onclick="PriceHLClicked()">Pirce (Hight to Low)</a>
          </div>
        </div>
      </div>
      <div id="customizer">
        <div id="clothingDiv">
          <div class="bigDot"></div>
          <a id="clothingText">CLOTHING</a>
          <div class="bigDot"></div>
        </div>
        <div id="clothingCheckboxList">
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="hoodiesCheckbox"
              onclick="hoodiesCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">Hoodies</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="tshirtsCheckbox"
              onclick="tshirtsCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">T-shirts & Tops</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="shirtsCheckbox"
              onclick="shirtsCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">Shirts</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="sweatshirtsCheckbox"
              onclick="sweatshirtsCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">Sweatshirts</a>
          </label>
        </div>

        <div id="clothingDiv">
          <div class="bigDot"></div>
          <a id="clothingText">SIZE</a>
          <div class="bigDot"></div>
        </div>
        <div id="sizeCheckboxList">
          <label class="checkBoxContainer">
            <input type="checkbox" id="SCheckbox" onclick="SCheckboxPress()" />
            <span class="checkmark"></span>
            <a class="checkBoxText">S</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input type="checkbox" id="MCheckbox" onclick="MCheckboxPress()" />
            <span class="checkmark"></span>
            <a class="checkBoxText">M</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input type="checkbox" id="LCheckbox" onclick="LCheckboxPress()" />
            <span class="checkmark"></span>
            <a class="checkBoxText">L</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="XLCheckbox"
              onclick="XLCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">XL</a>
          </label>
          <div class="checkBoxDivider"></div>
          <label class="checkBoxContainer">
            <input
              type="checkbox"
              id="XXLCheckbox"
              onclick="XXLCheckboxPress()"
            />
            <span class="checkmark"></span>
            <a class="checkBoxText">XXL</a>
          </label>
        </div>

        <div id="clothingDiv">
          <div class="bigDot"></div>
          <a id="clothingText">PRICE</a>
          <div class="bigDot"></div>
        </div>

        <div id="rangeSlider" class="range-slider">
          <div class="range-group">
            <input
              class="range-input"
              id="sliderMin"
              value="10"
              min="1"
              max="300"
              step="1"
              type="range"
            />
            <input
              class="range-input"
              id="sliderMax"
              value="300"
              min="1"
              max="300"
              step="1"
              type="range"
            />
          </div>
          <div class="number-group">
            <input
              class="number-input"
              id="numberInputLeft"
              type="number"
              value="10"
              min="1"
              max="300"
            />
            <input
              class="number-input"
              id="numberInputRight"
              type="number"
              value="300"
              min="1"
              max="300"
            />
          </div>
        </div>
        <button onclick="ApplyFilterButton()" id="submitPriceButton">
          APPLY
        </button>
      </div>
      <div id="productOutput">
          <!-- <div class="product" onmouseover="">
              <div class="productImageDiv">
                  <img src="resources/icons/greyHoodie.png" alt="Grey Hoodie" class="productImage">
                  <img src="resources/icons/hoodieModel3by2.png" alt="Grey Hoodie Second Image" class="productSecondImage">
              </div>
              <div class="productDividerLine">
                  <a class="productName">
                      Grey Hoodie
                  </a>
                  <div class="productSaleDiv">
                    <a class="productPriceBeforeSale">
                        $100.00
                    </a>
                    <a class="productSaleDivDot">
                      ‚óè
                    </a>
                    <a class="productSaleAmount">
                      40%
                    </a>
                  </div>
                  <a class="productPrice">
                      $60.00
                  </a>
                  <a class="productAvailableSizes">Available sizes:&nbsp;&nbsp;S, M, L, XL, XXL</a>
                  <div class="productColors">
                      <a class="productAvailableColorsText">Available colors:</a>
                      <div class="productColorCircle"></div>
                      <div class="productColorCircle"></div>
                      <div class="productColorCircle"></div>
                      <div class="productColorCircle"></div>
                  </div>
              </div>
          </div> -->
      </div>
    </div>

    <script src="resources/women/priceSlider.js"></script>
    <script src="resources/women/dropdown.js"></script>
    <script src="resources/women/pagination.js"></script>
    <script>
      // Initialize Firebase
      // TODO: Replace with your project's customized code snippet
      var config = {
        apiKey: "AIzaSyCkBvDNzSvorpEdz2twDAVI09x-FaVsDGg",
        authDomain: "timedshop-a5a66.firebaseapp.com",
        projectId: "timedshop-a5a66",
        storageBucket: "timedshop-a5a66.appspot.com",
        messagingSenderId: "172835576987",
        appId: "1:172835576987:web:2e588ca7a77cc008affa3e",
        measurementId: "G-3VCHXLRX5K",
      };
      firebase.initializeApp(config);

      // Initialize Firebase
      const db = firebase.firestore();
      const storage = firebase.storage();
      let querySnapshot;
      params = new URLSearchParams(location.search);
      // if(params.get("maxPages")==null)
      // {
      //   const docRef = doc(db, "women", "pages");
      //   const docSnap = await getDoc(docRef);

      //   if (docSnap.exists()) {
      //     params.append("maxPages",docSnap.data().numberOfPages);
      //     location.search = params;
      //   } else {
      //     // doc.data() will be undefined in this case
      //     console.log("No such document!");
      //   }
      // }
      var minPrice, maxPrice;
      if (params.get("minPrice") == null && params.get("maxPrice") == null) {
        db.collection("women")
          .doc("pages")
          .get()
          .then((docSnap) => {
            if (docSnap.exists) {
              document.getElementById("sliderMin").value =
                docSnap.data().minPrice;
              document.getElementById("sliderMin").min =
                docSnap.data().minPrice;
              document.getElementById("sliderMin").max =
                docSnap.data().maxPrice;
              document.getElementById("numberInputLeft").value =
                docSnap.data().minPrice;
              document.getElementById("numberInputLeft").min =
                docSnap.data().minPrice;
              document.getElementById("numberInputLeft").max =
                docSnap.data().maxPrice;

              document.getElementById("sliderMax").value =
                docSnap.data().maxPrice;
              document.getElementById("sliderMax").max =
                docSnap.data().maxPrice;
              document.getElementById("sliderMax").min =
                docSnap.data().minPrice;
              document.getElementById("numberInputRight").value =
                docSnap.data().maxPrice;
              document.getElementById("numberInputRight").max =
                docSnap.data().maxPrice;
              document.getElementById("numberInputRight").min =
                docSnap.data().minPrice;

              localStorage.setItem(
                "minPriceFromDatabase",
                JSON.stringify(docSnap.data().minPrice)
              );
              localStorage.setItem(
                "maxPriceFromDatabase",
                JSON.stringify(docSnap.data().maxPrice)
              );
              // if (
              //   params.get("minPrice") == null &&
              //   params.get("maxPrice") == null
              // ) {
              //   params.append("minPrice", docSnap.data().minPrice);
              //   params.append("maxPrice", docSnap.data().maxPrice);
              //   location.search = params;
              // }
            } else {
              // doc.data() will be undefined in this case
              console.log("No such document!");
            }
          });
      } else {
        minPrice = params.get("minPrice");
        maxPrice = params.get("maxPrice");
        var minPriceDatabase = localStorage.getItem("minPriceFromDatabase");
        var maxPriceDatabase = localStorage.getItem("maxPriceFromDatabase");
        document.getElementById("sliderMin").value = minPrice;
        document.getElementById("sliderMin").min = minPriceDatabase;
        document.getElementById("sliderMin").max = maxPriceDatabase;
        document.getElementById("numberInputLeft").value = minPrice;
        document.getElementById("numberInputLeft").min = minPriceDatabase;
        document.getElementById("numberInputLeft").max = maxPriceDatabase;

        document.getElementById("sliderMax").value = maxPrice;
        document.getElementById("sliderMax").max = maxPriceDatabase;
        document.getElementById("sliderMax").min = minPriceDatabase;
        document.getElementById("numberInputRight").value = maxPrice;
        document.getElementById("numberInputRight").max = maxPriceDatabase;
        document.getElementById("numberInputRight").min = minPriceDatabase;
      }
      minPrice = parseInt(minPrice);
      maxPrice = parseInt(maxPrice);
      var currentPage = 1;
      var sortBy = params.get("sortBy");
      if (params.get("type") != null) type = params.get("type");
      if (params.get("size") != null) size = params.get("size");
      let whereType = [];
      let whereSize = [];
      whereSize[0] = "coco";
      let q;
      const productOutput = document.getElementById("productOutput");
      const paginationDiv = document.getElementById("paginationDiv");
      var idd = 1203;

      if (type != undefined) {
        if (type.includes("hoodies")) whereType.push("hoodie");
        if (type.includes("tshir")) whereType.push("tshirt");
        if (type.includes("shirts")) whereType.push("shirt");
        if (type.includes("sweatsh")) whereType.push("sweatshirt");
      }
      if (size != undefined) {
        if (size.includes("small")) whereSize.push("S");
        if (size.includes("medium")) whereSize.push("M");
        if (size.includes("large")) whereSize.push("L");
        if (size.includes("extral")) whereSize.push("XL");
        if (size.includes("extraxl")) whereSize.push("XXL");
      }
      window.addEventListener('scroll',()=>{
        //console.log("windowHeight:",window.scrollY) //scrolled from top
        //console.log("windowInnerHeight:",window.innerHeight) //visible part of screen
        if(window.scrollY + window.innerHeight >=
        document.documentElement.scrollHeight){
          console.log("reached bottom");
          loadProducts()
        }
      })
      var lastVisibleQueryFromPrevPage;
      loadProducts();
      function loadProducts()
      {
      if (sortBy == "newArrival") {
        if (currentPage > 1) {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
              {
                q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .orderBy("date", "desc")
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("date", "desc")
                  .where("type", "in", whereType)
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
              {
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .orderBy("date", "desc")
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("date", "desc")
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .orderBy("date", "desc")
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("date", "desc")
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .orderBy("date", "desc")
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("date", "desc")
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
        } else {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .orderBy("date", "desc")
                  .where("type", "in", whereType);
              else
                q = db
                  .collection("women")
                  .orderBy("date", "desc")
                  .where("type", "in", whereType);
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .orderBy("date", "desc");
              else
                q = db
                  .collection("women")
                  .orderBy("date", "desc");
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .orderBy("date", "desc")
                .where("type", "in", whereType);
            else
              q = db
                .collection("women")
                .orderBy("date", "desc")
                .where("type", "in", whereType);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .orderBy("date", "desc");
            else
              q = db
                .collection("women")
                .orderBy("date", "desc");
            q = q.limit(18);
          }
        }
        var resultsNumber = 0;
        var idd = 1201;
        q.get().then((querySnapshot) => {
          querySnapshot.forEach((qdoc)=>{
            console.log('asd');
            resultsNumber++;
            if(resultsNumber == currentPage*16)
            {
              currentPage++;
            }
            lastVisibleQueryFromPrevPage = querySnapshot.docs[querySnapshot.docs.length-1];
            //var docRef;
            //console.log(new Date(qdoc.data().date * 1000));
            // for(var x = 1; x<=1; x++)
            // {
            //   idd++;
            //   if(idd <= 1220)
            //     docRef = setDoc(doc(db, "women",idd.toString()),qdoc.data());
            // }

            //product item
            var product = document.createElement("div");
            product.className = "product";

            //productImageDiv
            var productImageDiv = document.createElement("div");
            productImageDiv.className = "productImageDiv";
            product.appendChild(productImageDiv);

            //productFirstImage
            var productFirstImage = document.createElement("img");
            productFirstImage.className = "productImage";
            storage.ref().child(qdoc.id+"01.jpg").getDownloadURL()
            .then((url) => {
              productFirstImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //productSecondImage
            var productSecondImage = document.createElement("img");
            productSecondImage.className = "productSecondImage";
            storage.ref().child(qdoc.id+"02.jpg").getDownloadURL()
            .then((url) => {
              productSecondImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //Append First and Second Image to productImageDiv
            productImageDiv.appendChild(productFirstImage);
            productImageDiv.appendChild(productSecondImage);
            product.appendChild(productImageDiv);

            //productDividerLine
            var productDividerLine = document.createElement("div");
            productDividerLine.className = "productDividerLine";
            product.appendChild(productDividerLine);

            //productName
            var productName = document.createElement("a");
            productName.className = "productName";
            productName.innerText = qdoc.data().name;
            productDividerLine.appendChild(productName);

            //productPriceBeforeSale
            if (!isNaN(qdoc.data().priceBeforeSale)) {
              var productSaleDiv = document.createElement("div");
              productSaleDiv.className = "productSaleDiv";

              var productPriceBeforeSale = document.createElement("a");
              productPriceBeforeSale.className = "productPriceBeforeSale";
              productPriceBeforeSale.innerText =
              "$" + qdoc.data().priceBeforeSale + ".00";
              
              var productSaleDot = document.createElement("a");
              productSaleDot.className = "productSaleDivDot";
              productSaleDot.innerText = "‚óè";
              
              
              var productSaleAmount = document.createElement("a");
              productSaleAmount.className = "productSaleAmount";
              productSaleAmount.innerText = (((Math.abs(qdoc.data().priceBeforeSale - qdoc.data().price))/qdoc.data().priceBeforeSale)*100).toFixed() + "%";
              
              productSaleDiv.appendChild(productPriceBeforeSale);
              productSaleDiv.appendChild(productSaleDot);
              productSaleDiv.appendChild(productSaleAmount);
              productDividerLine.appendChild(productSaleDiv);
            }

            //productPrice
            var productPrice = document.createElement("a");
            productPrice.className = "productPrice";
            var price = qdoc.data().price;
            productPrice.innerText = "$" + price + ".00";
            productDividerLine.appendChild(productPrice);

            //productAvailableSizes
            var productAvailableSizes = document.createElement("a");
            productAvailableSizes.className = "productAvailableSizes";
            let sizes = "";
            var arraySize = qdoc.data().sizes.length;
            for (let i = 0; i < arraySize; i++) {
              if (i == arraySize - 1) {
                sizes = sizes + qdoc.data().sizes[i];
              } else {
                sizes = sizes + qdoc.data().sizes[i] + ", ";
              }
            }
            productAvailableSizes.innerText = "Available sizes: " + sizes;
            productDividerLine.appendChild(productAvailableSizes);

            //productAvailableColors
            var productAvailableColors = document.createElement("div");
            productAvailableColors.className = "productColors";
            var productAvailableColorsText = document.createElement("a");
            productAvailableColorsText.innerText = "Available colors:";
            productAvailableColorsText.className = "productAvailableColorsText";
            productAvailableColors.appendChild(productAvailableColorsText);
            var productColorsLength = qdoc.data().colors.length;
            var productColorCircle;
            for (let i = 0; i < productColorsLength; i++) {
            productColorCircle = document.createElement("div");
            productColorCircle.className = "productColorCircle";
            productColorCircle.style.backgroundColor = qdoc.data().colors[i];
            productAvailableColors.appendChild(productColorCircle);
          }
          productDividerLine.appendChild(productAvailableColors);

          product.appendChild(productDividerLine);

          document
          .getElementById("productOutput")
          .insertBefore(product, paginationDiv);
        })});
      } else if(sortBy=="priceHL")
      {
        if (currentPage > 1) {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
              {
                q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .where("type", "in", whereType)
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
              {
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
        } else {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .where("type", "in", whereType);
              else
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .where("type", "in", whereType);
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "desc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
              else
                q = db
                  .collection("women")
                  .orderBy("price", "desc");
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType);
            else
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("type", "in", whereType);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "desc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
            else
              q = db
                .collection("women")
                .orderBy("price", "desc");
            q = q.limit(18);
          }
        }
        var resultsNumber = 0;
        var idd = 1201;
        q.get().then((querySnapshot) => {
          querySnapshot.forEach((qdoc)=>{
            console.log('asd');
            resultsNumber++;
            if(resultsNumber == currentPage*16)
            {
              currentPage++;
            }
            lastVisibleQueryFromPrevPage = querySnapshot.docs[querySnapshot.docs.length-1];
            //var docRef;
            //console.log(new Date(qdoc.data().date * 1000));
            // for(var x = 1; x<=1; x++)
            // {
            //   idd++;
            //   if(idd <= 1220)
            //     docRef = setDoc(doc(db, "women",idd.toString()),qdoc.data());
            // }

            //product item
            var product = document.createElement("div");
            product.className = "product";

            //productImageDiv
            var productImageDiv = document.createElement("div");
            productImageDiv.className = "productImageDiv";
            product.appendChild(productImageDiv);

            //productFirstImage
            var productFirstImage = document.createElement("img");
            productFirstImage.className = "productImage";
            storage.ref().child(qdoc.id+"01.jpg").getDownloadURL()
            .then((url) => {
              productFirstImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //productSecondImage
            var productSecondImage = document.createElement("img");
            productSecondImage.className = "productSecondImage";
            storage.ref().child(qdoc.id+"02.jpg").getDownloadURL()
            .then((url) => {
              productSecondImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //Append First and Second Image to productImageDiv
            productImageDiv.appendChild(productFirstImage);
            productImageDiv.appendChild(productSecondImage);
            product.appendChild(productImageDiv);

            //productDividerLine
            var productDividerLine = document.createElement("div");
            productDividerLine.className = "productDividerLine";
            product.appendChild(productDividerLine);

            //productName
            var productName = document.createElement("a");
            productName.className = "productName";
            productName.innerText = qdoc.data().name;
            productDividerLine.appendChild(productName);

            //productPriceBeforeSale
            if (!isNaN(qdoc.data().priceBeforeSale)) {
              var productPriceBeforeSale = document.createElement("a");
              productPriceBeforeSale.className = "productPriceBeforeSale";
              productPriceBeforeSale.innerText =
              "$" + qdoc.data().priceBeforeSale + ".00";
              productDividerLine.appendChild(productPriceBeforeSale);
            }

            //productPrice
            var productPrice = document.createElement("a");
            productPrice.className = "productPrice";
            var price = qdoc.data().price;
            productPrice.innerText = "$" + price + ".00";
            productDividerLine.appendChild(productPrice);

            //productAvailableSizes
            var productAvailableSizes = document.createElement("a");
            productAvailableSizes.className = "productAvailableSizes";
            let sizes = "";
            var arraySize = qdoc.data().sizes.length;
            for (let i = 0; i < arraySize; i++) {
              if (i == arraySize - 1) {
                sizes = sizes + qdoc.data().sizes[i];
              } else {
                sizes = sizes + qdoc.data().sizes[i] + ", ";
              }
            }
            productAvailableSizes.innerText = "Available sizes: " + sizes;
            productDividerLine.appendChild(productAvailableSizes);

            //productAvailableColors
            var productAvailableColors = document.createElement("div");
            productAvailableColors.className = "productColors";
            var productAvailableColorsText = document.createElement("a");
            productAvailableColorsText.innerText = "Available colors:";
            productAvailableColorsText.className = "productAvailableColorsText";
            productAvailableColors.appendChild(productAvailableColorsText);
            var productColorsLength = qdoc.data().colors.length;
            var productColorCircle;
            for (let i = 0; i < productColorsLength; i++) {
            productColorCircle = document.createElement("div");
            productColorCircle.className = "productColorCircle";
            productColorCircle.style.backgroundColor = qdoc.data().colors[i];
            productAvailableColors.appendChild(productColorCircle);
          }
          productDividerLine.appendChild(productAvailableColors);

          product.appendChild(productDividerLine);

          document
          .getElementById("productOutput")
          .insertBefore(product, paginationDiv);
        })});
        } else if(sortBy=="priceLH")
        {
          if (currentPage > 1) {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
              {
                q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("type", "in", whereType)
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
              {
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              else
              {
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .startAfter(lastVisibleQueryFromPrevPage);
              }
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("type", "in", whereType)
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .startAfter(lastVisibleQueryFromPrevPage);
            else
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .startAfter(lastVisibleQueryFromPrevPage);
            q = q.limit(18);
          }
        } else {
          if (whereSize.length - 1 != 0) {
            if (whereType.length != 0) {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
                  .where("type", "in", whereType);
              else
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("type", "in", whereType);
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            } else {
              if(!isNaN(minPrice))
                q = db
                  .collection("women")
                  .orderBy("price", "asc")
                  .where("price", "<=", maxPrice)
                  .where("price", ">=", minPrice)
              else
                q = db
                  .collection("women")
                  .orderBy("price", "asc");
              for (var i = 1; i <= whereSize.length - 1; i++) {
                q = q.where(whereSize[i], "==", true);
              }
              q = q.limit(18);
            }
          } else if (whereType.length != 0)
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
                .where("type", "in", whereType);
            else
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("type", "in", whereType);
            q = q.limit(18);
          }
          else
          {
            if(!isNaN(minPrice))
              q = db
                .collection("women")
                .orderBy("price", "asc")
                .where("price", "<=", maxPrice)
                .where("price", ">=", minPrice)
            else
              q = db
                .collection("women")
                .orderBy("price", "asc");
            q = q.limit(18);
          }
        }
        var resultsNumber = 0;
        var idd = 1201;
        q.get().then((querySnapshot) => {
          querySnapshot.forEach((qdoc)=>{
            console.log('asd');
            resultsNumber++;
            if(resultsNumber == currentPage*16)
            {
              currentPage++;
            }
            lastVisibleQueryFromPrevPage = querySnapshot.docs[querySnapshot.docs.length-1];
            //var docRef;
            //console.log(new Date(qdoc.data().date * 1000));
            // for(var x = 1; x<=1; x++)
            // {
            //   idd++;
            //   if(idd <= 1220)
            //     docRef = setDoc(doc(db, "women",idd.toString()),qdoc.data());
            // }

            //product item
            var product = document.createElement("div");
            product.className = "product";

            //productImageDiv
            var productImageDiv = document.createElement("div");
            productImageDiv.className = "productImageDiv";
            product.appendChild(productImageDiv);

            //productFirstImage
            var productFirstImage = document.createElement("img");
            productFirstImage.className = "productImage";
            storage.ref().child(qdoc.id+"01.jpg").getDownloadURL()
            .then((url) => {
              productFirstImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //productSecondImage
            var productSecondImage = document.createElement("img");
            productSecondImage.className = "productSecondImage";
            storage.ref().child(qdoc.id+"02.jpg").getDownloadURL()
            .then((url) => {
              productSecondImage.src = url;
            })
            .catch((error) => {
              console.log(error);
            });

            //Append First and Second Image to productImageDiv
            productImageDiv.appendChild(productFirstImage);
            productImageDiv.appendChild(productSecondImage);
            product.appendChild(productImageDiv);

            //productDividerLine
            var productDividerLine = document.createElement("div");
            productDividerLine.className = "productDividerLine";
            product.appendChild(productDividerLine);

            //productName
            var productName = document.createElement("a");
            productName.className = "productName";
            productName.innerText = qdoc.data().name;
            productDividerLine.appendChild(productName);

            //productPriceBeforeSale
            if (!isNaN(qdoc.data().priceBeforeSale)) {
              var productPriceBeforeSale = document.createElement("a");
              productPriceBeforeSale.className = "productPriceBeforeSale";
              productPriceBeforeSale.innerText =
              "$" + qdoc.data().priceBeforeSale + ".00";
              productDividerLine.appendChild(productPriceBeforeSale);
            }

            //productPrice
            var productPrice = document.createElement("a");
            productPrice.className = "productPrice";
            var price = qdoc.data().price;
            productPrice.innerText = "$" + price + ".00";
            productDividerLine.appendChild(productPrice);

            //productAvailableSizes
            var productAvailableSizes = document.createElement("a");
            productAvailableSizes.className = "productAvailableSizes";
            let sizes = "";
            var arraySize = qdoc.data().sizes.length;
            for (let i = 0; i < arraySize; i++) {
              if (i == arraySize - 1) {
                sizes = sizes + qdoc.data().sizes[i];
              } else {
                sizes = sizes + qdoc.data().sizes[i] + ", ";
              }
            }
            productAvailableSizes.innerText = "Available sizes: " + sizes;
            productDividerLine.appendChild(productAvailableSizes);

            //productAvailableColors
            var productAvailableColors = document.createElement("div");
            productAvailableColors.className = "productColors";
            var productAvailableColorsText = document.createElement("a");
            productAvailableColorsText.innerText = "Available colors:";
            productAvailableColorsText.className = "productAvailableColorsText";
            productAvailableColors.appendChild(productAvailableColorsText);
            var productColorsLength = qdoc.data().colors.length;
            var productColorCircle;
            for (let i = 0; i < productColorsLength; i++) {
            productColorCircle = document.createElement("div");
            productColorCircle.className = "productColorCircle";
            productColorCircle.style.backgroundColor = qdoc.data().colors[i];
            productAvailableColors.appendChild(productColorCircle);
          }
          productDividerLine.appendChild(productAvailableColors);

          product.appendChild(productDividerLine);

          document
          .getElementById("productOutput")
          .insertBefore(product, paginationDiv);
        })});
        }
      }
    </script>
  </body>
</html>
